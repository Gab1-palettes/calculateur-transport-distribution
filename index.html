  <!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estimation Franco Livraison - Palettes Distribution</title>

    <!-- Leaflet -->
    <link
        rel="stylesheet"
        href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        crossorigin=""
    />
    <script
        src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        crossorigin=""
    ></script>

    <style>
        * { box-sizing: border-box; }

        body {
            font-family: Arial, sans-serif;
            margin: 0;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, #4caf50, #2196f3);
        }

        .form-container {
            background: rgba(255,255,255,0.95);
            padding: 30px 25px;
            border-radius: 15px;
            max-width: 520px;
            width: 95%;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        h1 {
            text-align: center;
            margin-top: 0;
            text-transform: uppercase;
        }

        .subtitle {
            text-align: center;
            font-size: 0.95rem;
            color: #555;
            margin-bottom: 20px;
        }

        label {
            font-weight: 600;
            font-size: 0.9rem;
        }

        input, select {
            width: 100%;
            padding: 8px 10px;
            margin-bottom: 15px;
            border-radius: 6px;
            border: 1px solid #ccc;
        }

        button {
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            border: none;
            background: #2196f3;
            color: #fff;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
        }

        .result {
            margin-top: 15px;
            padding: 12px;
            border-radius: 8px;
            background: #e8f5e9;
            border: 1px solid #c8e6c9;
            font-size: 0.95rem;
        }

        #map {
            margin-top: 15px;
            height: 240px;
            border-radius: 10px;
            border: 1px solid #ddd;
        }

        .disclaimer {
            font-size: 0.8rem;
            color: #666;
            margin-top: 10px;
        }
    </style>
</head>

<body>
<div class="form-container">
    <h1>Estimation franco livraison</h1>
    <p class="subtitle">
        Indication basée sur le temps de parcours et le volume.<br>
        Validation finale réalisée par notre équipe.
    </p>

    <div id="palette-info" style="font-style:italic;font-size:0.9rem;margin-bottom:10px;"></div>

    <form id="livraison-form">
        <label>Distance estimée depuis notre dépôt (km)</label>
        <input type="number" id="distance" min="1" required placeholder="Ex. 120">

        <label>Nombre de palettes</label>
        <input type="number" id="palettes" min="1" required placeholder="Ex. 33">

        <label>Type de chargement</label>
        <select id="chargement">
            <option value="partiel">Groupage / Chargement partiel</option>
            <option value="complet">Camion complet</option>
        </select>

        <button type="submit">Estimer le franco / palette</button>
    </form>

    <div id="resultat" class="result" style="display:none;"></div>

    <div id="map"></div>

    <p class="disclaimer">
        Estimation indicative basée sur un modèle temps transport (80 €/h).
        Les conditions réelles peuvent évoluer selon l’accès, la saison et le volume.
    </p>
</div>

<script>
    const params = new URLSearchParams(window.location.search);
    const refPalette = params.get("ref");
    const info = document.getElementById("palette-info");

    info.textContent = refPalette
        ? "Référence sélectionnée : " + refPalette
        : "Sélectionnez vos palettes pour lancer une estimation.";

    const form = document.getElementById("livraison-form");
    const resDiv = document.getElementById("resultat");

    form.addEventListener("submit", function(e) {
        e.preventDefault();

        const distance = Number(document.getElementById("distance").value);
        const palettes = Number(document.getElementById("palettes").value);
        const chargement = document.getElementById("chargement").value;

        let forfait = 100;
        let tauxHoraire = 80;     // €/h
        let vitesseMin = 70;
        let vitesseMax = 90;
        let variablePalette = 0.30;

        if (chargement === "complet") {
            forfait = 85;
            variablePalette = 0.20;
        }

        const tempsMin = distance / vitesseMax;
        const tempsMax = distance / vitesseMin;

        const totalMin = forfait + (tempsMin * tauxHoraire) + (palettes * variablePalette);
        const totalMax = forfait + (tempsMax * tauxHoraire) + (palettes * variablePalette);

        const francoMin = totalMin / palettes;
        const francoMax = totalMax / palettes;

        resDiv.style.display = "block";
        resDiv.innerHTML =
            "<strong>Fourchette franco indicative :</strong><br>" +
            "<strong>" + francoMin.toFixed(2) + " €</strong> à <strong>" +
            francoMax.toFixed(2) + " €</strong> HT / palette livrée<br>" +
            "<span style='font-size:0.85rem;'>Base : 80 €/h • " +
            palettes + " palettes • " + distance + " km</span>";
    });

    // Carte
    const map = L.map("map").setView([45.246, -0.256], 8);
    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution: "&copy; OpenStreetMap"
    }).addTo(map);
    L.marker([45.246, -0.256]).addTo(map)
        .bindPopup("Dépôt Palettes Distribution")
        .openPopup();
</script>
</body>
</html>
